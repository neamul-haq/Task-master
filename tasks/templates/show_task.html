{% extends "dashboard/dashboard.html" %}
{% block title %}Tasks{% endblock title %}

{% block tasks %}
<div class="bg-white rounded-xl shadow-lg mb-12 overflow-hidden">
  <!-- Header Section -->
  <div class="px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-gray-100">
    <h2 class="text-2xl font-bold text-gray-800">📋 Task Overview</h2>
  </div>

  <!-- Search Input -->
  <div class="px-6 py-4">
    <div class="relative max-w-md w-full">
      <input v-model="search" placeholder="Search by title, status, or priority"
             class="w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" />
      <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18a7.5 7.5 0 006.15-3.35z" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Table Header -->
  <div class="grid grid-cols-4 px-6 py-3 border-t border-b border-gray-200 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50">
    <div>Task Title</div>
    <div>Priority</div>
    <div>Team</div>
    <div>Created</div>
  </div>

  <!-- Task Items -->
  <div class="divide-y divide-gray-100">
    <div v-for="task in paginatedTasks" :key="task.id" class="grid grid-cols-4 gap-4 px-6 py-5 hover:bg-gray-50 transition duration-150 items-center">

      <!-- Title & Status -->
      <div class="flex items-start gap-3">
        <div class="w-2.5 h-2.5 rounded-full mt-1"
             :class="{
               'bg-green-500': task.status === 'COMPLETED',
               'bg-yellow-500': task.status === 'IN_PROGRESS',
               'bg-red-500': task.status === 'PENDING',
               'bg-gray-400': !['COMPLETED', 'IN_PROGRESS', 'PENDING'].includes(task.status)
             }">
        </div>
        <div>
          <a :href="`/tasks/task/${task.id}/details/`" class="text-base font-semibold text-gray-800 hover:text-blue-600 transition">
            [[ task.title ]]
          </a>
          <p class="text-xs text-gray-400 mt-0.5">Status: [[ task.status ]]</p>
        </div>
      </div>

      <!-- Priority -->
      <div>
        <span :class="{
            'bg-gray-100 text-gray-800': task.priority === 'L',
            'bg-yellow-100 text-yellow-800': task.priority === 'M',
            'bg-red-100 text-red-800': task.priority === 'H'
          }"
          class="inline-block px-3 py-1 rounded-full text-sm font-medium">
          [[ task.priority_display ]]
        </span>
      </div>

      <!-- Team Members -->
      <div class="flex -space-x-3">
        <div v-for="(member, idx) in task.assigned_to" :key="idx" class="relative group" :title="member.full_name">
          <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-800 text-sm font-bold border-2 border-white">
            [[ member.first_name.slice(0, 1) ]]
          </div>
        </div>
      </div>

      <!-- Created At -->
      <div class="text-sm text-gray-500 flex items-center gap-1">
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>[[ new Date(task.created_at).toLocaleDateString() ]]</span>
      </div>
    </div>

    <div v-if="filteredTasks.length === 0" class="text-center py-6 text-gray-400 text-sm">
      No matching tasks found.
    </div>
  </div>

  <!-- Pagination -->
  <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center">
    <button @click="currentPage--" :disabled="currentPage === 1"
            class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 disabled:opacity-50">
      ← Previous
    </button>

    <span class="text-sm text-gray-600">Page [[ currentPage ]] of [[ taskTotalPages ]]</span>

    <button @click="currentPage++" :disabled="currentPage === taskTotalPages"
            class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 disabled:opacity-50">
      Next →
    </button>
  </div>
</div>
{% endblock tasks %}
