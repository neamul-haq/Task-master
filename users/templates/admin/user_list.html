{% extends "base.html" %}
{% load static %}

{% block content %}
<div id="user-table" class="container mx-auto p-6">
  <vuetable
    :fields="fields"
    :data="users"
    class="min-w-full bg-white shadow-md rounded-lg overflow-hidden"
    wrapper-class="table"
    row-class="hover:bg-gray-50"
  >
    <template #table-header="{ field }">
      <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        {{ field.label }}
      </th>
    </template>

    <template #table-row="{ row, field }">
      <td class="px-4 py-4 whitespace-nowrap">
        <span v-if="field.name === 'number'">{{ row.number }}</span>
        <span v-else-if="field.name === 'name'">{{ row.first_name }} {{ row.last_name }}</span>
        <span v-else-if="field.name === 'email'">{{ row.email }}</span>
        <span v-else-if="field.name === 'id'">{{ row.id }}</span>
        <span v-else-if="field.name === 'role'">{{ row.custom_role.role.name }}</span>
        <span v-else-if="field.name === 'action'">
          <a :href="`/assign-role/${row.id}`"
            class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded">
            Change Role
          </a>
        </span>
      </td>
    </template>
  </vuetable>
</div>

<script src="https://unpkg.com/vuetable-3@next"></script>
<script>
  const { createApp } = Vue;

  createApp({
    components: {
      Vuetable: window["vuetable-3"]
    },
    data() {
      return {
        users: JSON.parse(document.getElementById('users-json').textContent),
        fields: [
          { name: 'number', label: 'Number' },
          { name: 'name', label: 'Name' },
          { name: 'email', label: 'Email' },
          { name: 'id', label: 'User ID' },
          { name: 'role', label: 'Current Role' },
          { name: 'action', label: 'Action' }
        ]
      };
    }
  }).mount('#user-table');
</script>

<!-- Pass data from Django to Vue -->
<script id="users-json" type="application/json">
  {{ user_data|safe }}
</script>
{% endblock content %}
